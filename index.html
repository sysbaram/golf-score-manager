<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- 표준 모드 강제 및 렌더링 최적화 -->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    
    <!-- GitHub Pages 최적화 - 최소한의 설정 -->
    <script>
        // GitHub Pages 환경 감지
        const isGitHubPages = window.location.hostname.includes('github.io');
        if (isGitHubPages) {
            console.log('🔧 GitHub Pages 환경 - 최적화된 설정 적용');
        } else {
            console.log('🔧 로컬 환경');
        }
    </script>
    <meta name="description" content="Google Sheets와 연동하는 현대적인 골프 스코어 관리 시스템. 상세한 홀별 기록과 통계 분석을 제공합니다.">
    <meta name="keywords" content="골프, 스코어, 관리, 통계, Google Sheets, 라운드">
    <meta name="author" content="Golf Score Manager">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sysbaram.github.io/golf-score-manager/">
    <meta property="og:title" content="골프 스코어 관리 시스템">
    <meta property="og:description" content="Google Sheets와 연동하는 현대적인 골프 스코어 관리 시스템">
    <meta property="og:image" content="https://sysbaram.github.io/golf-score-manager/assets/preview.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://sysbaram.github.io/golf-score-manager/">
    <meta property="twitter:title" content="골프 스코어 관리 시스템">
    <meta property="twitter:description" content="Google Sheets와 연동하는 현대적인 골프 스코어 관리 시스템">
    <meta property="twitter:image" content="https://sysbaram.github.io/golf-score-manager/assets/preview.png">
    
    <title>골프 스코어 관리 시스템 | 현대적인 스코어 추적</title>
    
    <!-- 스타일시트 (GitHub Pages 최적화) -->
    <link rel="stylesheet" href="/golf-score-manager/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Google Fonts 최적화 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- PWA 관련 (GitHub Pages 최적화) -->
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./assets/apple-touch-icon.png">
    
    <!-- 성능 최적화 -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//apis.google.com">
    <link rel="dns-prefetch" href="//accounts.google.com">
    
    <!-- Google API 로딩 -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <h1>
                    <i class="fas fa-golf-ball-tee"></i> 
                    골프 스코어 관리
                </h1>
                <p>Google Sheets와 연동하는 현대적인 스마트 스코어 관리 시스템</p>
                <div class="header-features">
                    <span class="feature-badge">
                        <i class="fas fa-chart-line"></i> 상세 통계
                    </span>
                    <span class="feature-badge">
                        <i class="fas fa-mobile-alt"></i> 모바일 최적화
                    </span>
                    <span class="feature-badge">
                        <i class="fas fa-cloud"></i> 클라우드 동기화
                    </span>
                </div>
            </div>
            <div class="user-section">
                <div id="user-info" class="user-info" style="display: none;">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                    <span id="welcome-message">안녕하세요, <strong id="username-display"></strong>님!</span>
                        <small class="user-status">온라인</small>
                    </div>
                    <button id="logout-btn" class="btn btn-outline" onclick="handleLogout(); return false;">
                        <i class="fas fa-sign-out-alt"></i> 로그아웃
                    </button>
                </div>
                <div id="login-section" class="login-section">
                    <!-- 🔧 디버깅용 테스트 버튼 -->
                    <button class="btn btn-primary" 
                            onclick="console.log('🧪 테스트 버튼 클릭됨!'); alert('테스트 버튼 작동 확인!'); return false;"
                            style="margin-bottom: 10px; background: red;">
                        🧪 테스트 버튼
                    </button>
                    
                    <button id="login-btn" class="btn btn-outline" 
                            onclick="console.log('🔐 로그인 버튼 클릭됨!'); console.log('🔍 로그인 버튼 상태:', this); showLoginModal(); return false;"
                            style="pointer-events: auto !important; display: inline-block !important; visibility: visible !important;">
                        <i class="fas fa-sign-in-alt"></i> 로그인
                    </button>
                    <button id="register-btn" class="btn btn-outline"
                            onclick="console.log('📝 회원가입 버튼 클릭됨!'); console.log('🔍 회원가입 버튼 상태:', this); showRegisterModal(); return false;"
                            style="pointer-events: auto !important; display: inline-block !important; visibility: visible !important;">
                        <i class="fas fa-user-plus"></i> 회원가입
                    </button>
                </div>
            </div>
        </header>

        <!-- 네비게이션 -->
        <nav class="nav-tabs" style="display: none;">
            <button class="nav-tab active" data-tab="score-input">
                <i class="fas fa-plus-circle"></i> 스코어 입력
            </button>
            <button class="nav-tab" data-tab="rounds-history">
                <i class="fas fa-history"></i> 라운드 기록
            </button>
            <button class="nav-tab" data-tab="statistics">
                <i class="fas fa-chart-bar"></i> 통계
            </button>
        </nav>

        <!-- 로그인 안내 메시지 -->
        <div id="login-prompt" class="login-prompt">
            <div class="login-prompt-content">
                <div class="login-prompt-icon">
                    <i class="fas fa-golf-ball-tee"></i>
                </div>
                <h2>골프 스코어 관리 시작하기</h2>
                <p>Google Sheets와 연동된 스마트한 골프 스코어 관리 시스템입니다.<br>
                로그인하시면 스코어 입력, 기록 관리, 통계 분석 기능을 이용하실 수 있습니다.</p>
                <div class="login-prompt-features">
                    <div class="feature-item">
                        <i class="fas fa-chart-line"></i>
                        <span>상세 통계 분석</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>클라우드 자동 저장</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-mobile-alt"></i>
                        <span>모바일 최적화</span>
                    </div>
                </div>
                <div class="login-prompt-actions">
                    <button class="btn btn-primary" onclick="showLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> 로그인하기
                    </button>
                    <button class="btn btn-outline" onclick="showRegisterModal()">
                        <i class="fas fa-user-plus"></i> 회원가입
                    </button>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <main class="main-content" style="display: none;">
            <!-- 스코어 입력 탭 -->
            <div id="score-input" class="tab-content active">
                <div class="card">
                    <h2><i class="fas fa-edit"></i> 새 라운드 기록</h2>
                    <form id="score-form">
                        <div class="form-group">
                            <label for="course-name">코스 이름</label>
                            <input type="text" id="course-name" name="course_name" autocomplete="off" required>
                        </div>
                        
                        <div class="scores-grid">
                            <h3>홀별 상세 스코어 입력</h3>
                            <div class="detailed-scores-container">
                                <div class="holes-row">
                                    <div class="hole-group">
                                        <h4>아웃코스 (1-9홀)</h4>
                                        <div class="holes" id="holes-out">
                                            <!-- 1-9홀 상세 입력 필드 -->
                                        </div>
                                    </div>
                                    <div class="hole-group">
                                        <h4>인코스 (10-18홀)</h4>
                                        <div class="holes" id="holes-in">
                                            <!-- 10-18홀 상세 입력 필드 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="clear-scores" class="btn btn-secondary">
                                <i class="fas fa-eraser"></i> 초기화
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> 저장
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 라운드 기록 탭 -->
            <div id="rounds-history" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-list"></i> 라운드 기록</h2>
                    <div class="table-container">
                        <table id="rounds-table">
                            <thead>
                                <tr>
                                    <th>날짜</th>
                                    <th>플레이어</th>
                                    <th>코스</th>
                                    <th>총 스코어</th>
                                    <th>핸디캡</th>
                                    <th>상세보기</th>
                                </tr>
                            </thead>
                            <tbody id="rounds-tbody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>
                    <button id="refresh-rounds" class="btn btn-primary"
                            onclick="console.log('🔄 새로고침 버튼 클릭'); alert('새로고침 기능 (임시)');">
                        <i class="fas fa-sync-alt"></i> 새로고침
                    </button>
                </div>
            </div>

            <!-- 통계 탭 -->
            <div id="statistics" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-chart-line"></i> 내 통계</h2>
                    <div class="stats-form">
                        <button id="get-stats" class="btn btn-primary"
                                onclick="console.log('📊 통계 조회 버튼 클릭'); alert('통계 조회 기능 (임시)');">
                            <i class="fas fa-chart-bar"></i> 통계 조회
                        </button>
                    </div>
                    <div id="stats-results" class="stats-results">
                        <!-- 통계 결과가 여기에 표시됨 -->
                    </div>
                </div>
            </div>
        </main>

        <!-- 로딩 오버레이 -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner">
                <i class="fas fa-golf-ball-tee fa-spin"></i>
                <p>처리 중...</p>
            </div>
        </div>

        <!-- 알림 메시지 -->
        <div id="notification" class="notification">
            <span id="notification-message"></span>
            <button id="notification-close" onclick="this.parentElement.style.display='none';">&times;</button>
        </div>

        <!-- 로그인 모달 -->
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-sign-in-alt"></i> 로그인</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="login-form" onsubmit="handleLoginSubmit(event); return false;">
                    <div class="form-group">
                        <label for="login-username">사용자명 또는 이메일</label>
                        <input type="text" id="login-username" name="username" placeholder="사용자명 또는 이메일 주소" autocomplete="username" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">비밀번호</label>
                        <input type="password" id="login-password" name="password" autocomplete="current-password" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary modal-close">취소</button>
                        <button type="submit" class="btn btn-primary">로그인</button>
                    </div>
                    <div class="divider">또는</div>
                    <button type="button" id="google-login-btn" class="btn btn-google" 
                            onclick="console.log('🔐 모달 내부 Google 로그인 버튼 클릭됨!'); handleGoogleLogin(); return false;"
                            style="pointer-events: auto !important; display: block !important; visibility: visible !important;">
                        <i class="fab fa-google"></i> Google로 로그인
                    </button>
                </form>
            </div>
        </div>

        <!-- 회원가입 모달 -->
        <div id="register-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-user-plus"></i> 회원가입</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="register-form" onsubmit="handleRegisterSubmit(event); return false;">
                    <div class="form-group">
                        <label for="register-username">사용자명</label>
                        <input type="text" id="register-username" name="username" autocomplete="username" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">이메일</label>
                        <input type="email" id="register-email" name="email" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">비밀번호</label>
                        <input type="password" id="register-password" name="password" autocomplete="new-password" required minlength="6">
                        <small>비밀번호는 6자 이상이어야 합니다.</small>
                    </div>
                    <div class="form-group">
                        <label for="register-password-confirm">비밀번호 확인</label>
                        <input type="password" id="register-password-confirm" name="password_confirm" autocomplete="new-password" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary modal-close">취소</button>
                        <button type="submit" class="btn btn-primary">회원가입</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 간소화된 리소스 검증 -->
    <script>
        // 기본 페이지 상태 확인
        function checkPageStatus() {
            console.log('📋 페이지 상태:');
            console.log('  - DOCTYPE:', document.doctype ? 'HTML5 ✅' : '없음 ❌');
            console.log('  - 렌더링 모드:', document.compatMode === 'CSS1Compat' ? 'Standards Mode ✅' : 'Quirks Mode ❌');
            console.log('  - 준비 상태:', document.readyState);
            
            // 스타일시트 간단 확인
            const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
            console.log(`🎨 스타일시트: ${stylesheets.length}개 로드됨`);
            
            // 스크립트 간단 확인
            const scripts = document.querySelectorAll('script[src]');
            console.log(`📜 외부 스크립트: ${scripts.length}개 로드됨`);
        }
        
        // 페이지 로드 완료 후 확인
        function initializeAfterPageLoad() {
            checkPageStatus();
            console.log('🚀 페이지 로드 완료 - Google API 초기화 진행');
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeAfterPageLoad);
        } else {
            initializeAfterPageLoad();
        }
    </script>

    <!-- Google API 초기화 -->
    <script>
        console.log('🚀 Google API 초기화 준비 완료');
    </script>
    
    <!-- JavaScript 로드 확인 스크립트 (임시 디버깅) -->
    <script>
        console.log('🔍 HTML 페이지 로드 시작...');
        console.log('📄 document.readyState:', document.readyState);
        
        // DOM이 로드되면 기본 상태 확인
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📋 DOMContentLoaded 이벤트 발생');
            console.log('🔍 기본 DOM 요소 확인:');
            console.log('  - login-btn:', document.getElementById('login-btn'));
            console.log('  - register-btn:', document.getElementById('register-btn'));
            console.log('  - body:', document.body);
            console.log('  - 전체 button 개수:', document.querySelectorAll('button').length);
        });
        
        // 페이지 완전 로드 후 확인
        window.addEventListener('load', function() {
            console.log('🌐 window.load 이벤트 발생');
            console.log('🔍 JavaScript 파일 로드 상태:');
            console.log('  - window.golfApp:', typeof window.golfApp);
            console.log('  - 데모 모드 운영 중');
        });
    </script>
    
    <!-- 앱 스크립트들 (GitHub Pages 최적화) - 순서 중요 -->
    <script>
        // 스크립트 로딩 상태 추적
        window.scriptLoadStatus = {
            googleSheetsAPI: false,
            appGitHubPages: false
        };
        
        function checkAllScriptsLoaded() {
            const allLoaded = window.scriptLoadStatus.googleSheetsAPI && 
                             window.scriptLoadStatus.appGitHubPages;
            
            console.log('📊 스크립트 로딩 상태:', window.scriptLoadStatus);
            
            if (allLoaded) {
                console.log('🎉 모든 스크립트 로딩 완료!');
            }
        }
    </script>
    
    <script src="/golf-score-manager/static/js/google-sheets-api.js"></script>
    <script src="/golf-score-manager/static/js/app-github-pages.js"></script>
            
    <!-- 긴급 수정: 직접 모달 함수 정의 -->
    <script>
        console.log('🚨 긴급 수정: 직접 모달 함수 정의');
        
        // 로그인 모달 표시 함수
        function showLoginModal() {
            console.log('🔐 showLoginModal() 호출됨');
            const modal = document.getElementById('login-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('✅ 로그인 모달 표시 완료');
            } else {
                console.error('❌ 로그인 모달을 찾을 수 없음');
                alert('로그인 모달을 찾을 수 없습니다.');
            }
        }
        
        // 회원가입 모달 표시 함수
        function showRegisterModal() {
            console.log('📝 showRegisterModal() 호출됨');
            const modal = document.getElementById('register-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('✅ 회원가입 모달 표시 완료');
            } else {
                console.error('❌ 회원가입 모달을 찾을 수 없음');
                alert('회원가입 모달을 찾을 수 없습니다.');
            }
        }
        
        // 모달 닫기 함수
        function closeModal(modalId) {
            console.log('❌ closeModal() 호출됨:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                console.log('✅ 모달 닫기 완료');
            }
        }
        
        // DOM 로드 후 모달 닫기 이벤트 설정
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 모달 닫기 이벤트 설정 중...');
            
            // 모든 모달 닫기 버튼
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.onclick = function(e) {
                    const modal = e.target.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                };
            });
            
            // 모달 배경 클릭으로 닫기
            document.querySelectorAll('.modal').forEach(modal => {
                modal.onclick = function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                };
            });
            
            console.log('✅ 모달 닫기 이벤트 설정 완료');
        });
        
        // 데모 모드 - Google API 강제 초기화 비활성화
        console.log('🎭 데모 모드 - Google API 강제 초기화 비활성화');
        
        // Google Sheets API 호출 함수들
        async function handleLoginSubmit(event) {
            event.preventDefault();
            console.log('🔐 handleLoginSubmit() 호출됨');
            
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                alert('사용자명과 비밀번호를 입력해주세요.');
                return;
            }
            
            console.log('📡 로그인 시도:', username);
            
            try {
                let api = null;
                
                // 1순위: golfApp의 googleSheetsAPI 사용
                if (window.golfApp && window.golfApp.googleSheetsAPI && window.golfApp.isInitialized) {
                    console.log('🔄 golfApp.googleSheetsAPI 사용');
                    api = window.golfApp.googleSheetsAPI;
                } 
                
                // Google Sheets API 사용 가능한 경우
                if (api) {
                    console.log('📡 Google Sheets API로 로그인 시도...');
                    
                    // Google OAuth 로그인이 필요한 경우
                    if (!api.isSignedIn) {
                        console.log('🔐 Google OAuth 로그인 필요');
                        await api.signIn();
                    }
                    
                    const result = await api.loginUser(username, password);
                    
                    if (result && result.success) {
                        alert('Google Sheets 로그인 성공!');
                        document.getElementById('login-modal').style.display = 'none';
                        console.log('✅ Google Sheets 로그인 성공:', result.user);
                        updateUIAfterLogin(result.user);
                        return;
                    } else {
                        console.log('❌ Google Sheets 로그인 실패');
                        alert('Google Sheets 로그인 실패: ' + (result.error || '알 수 없는 오류'));
                    }
                } else {
                    console.log('⚠️ Google Sheets API 사용 불가');
                    alert('Google Sheets API가 초기화되지 않았습니다. 페이지를 새로고침하고 다시 시도해주세요.');
                }
                
            } catch (error) {
                console.error('❌ 로그인 오류:', error);
                alert('로그인 중 오류가 발생했습니다: ' + error.message + '\n데모 모드를 사용해주세요.');
            }
        }
        
        async function handleRegisterSubmit(event) {
            console.log('🚀🚀🚀 === 새로운 회원가입 함수 시작! ===');
            console.log('📝 handleRegisterSubmit() 호출됨');
            
            try {
                event.preventDefault();
                console.log('✅ 이벤트 preventDefault 완료');
                
                // 안전한 요소 접근
                const usernameEl = document.getElementById('register-username');
                const emailEl = document.getElementById('register-email');
                const passwordEl = document.getElementById('register-password');
                const confirmPasswordEl = document.getElementById('register-password-confirm');
                
                if (!usernameEl || !emailEl || !passwordEl || !confirmPasswordEl) {
                    console.error('❌ 회원가입 폼 요소를 찾을 수 없음');
                    alert('회원가입 폼에 오류가 있습니다. 페이지를 새로고침해주세요.');
                    return;
                }
                
                const username = usernameEl.value.trim();
                const email = emailEl.value.trim();
                const password = passwordEl.value;
                const confirmPassword = confirmPasswordEl.value;
                
                console.log('✅ 폼 데이터 추출 완료:', { username, email });
            
            if (!username || !email || !password || !confirmPassword) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('비밀번호가 일치하지 않습니다.');
                return;
            }
            
            console.log('📡 회원가입 시도:', username, email);
            
            // Google Sheets API를 통한 회원가입 처리
            console.log('🔄 Google Sheets API 회원가입 처리 중...');
            
            // Google Sheets API 사용 가능 여부 확인
            if (window.golfApp && window.golfApp.isInitialized && window.golfApp.googleSheetsAPI) {
                console.log('✅ Google Sheets API 사용 가능');
                
                try {
                    // Google OAuth 로그인 확인
                    if (!window.golfApp.googleSheetsAPI.isSignedIn) {
                        console.log('🔐 Google OAuth 로그인 필요...');
                        await window.golfApp.googleSheetsAPI.signIn();
                    }
                    
                    console.log('📝 Google Sheets에 사용자 등록 중...');
                    const result = await window.golfApp.googleSheetsAPI.registerUser(username, email, password);
                    
                    if (result && result.success) {
                        console.log('✅ Google Sheets 회원가입 성공!');
                        alert(`${username}님, Google Sheets에 회원가입이 완료되었습니다!`);
                        document.getElementById('register-modal').style.display = 'none';
                        document.getElementById('register-form').reset();
                        return;
                    } else {
                        throw new Error(result?.error || 'Google Sheets 등록 실패');
                    }
                } catch (error) {
                    console.error('❌ Google Sheets 회원가입 실패:', error);
                    alert('Google Sheets 연결에 실패했습니다. 페이지를 새로고침하고 다시 시도해주세요.');
                    return;
                }
            } else {
                console.log('⚠️ Google Sheets API 사용 불가');
                alert('Google Sheets API가 초기화되지 않았습니다. 페이지를 새로고침하고 다시 시도해주세요.');
                return;
            }
                
            } catch (error) {
                console.error('❌ 회원가입 오류:', error);
                console.error('❌ 오류 상세:', error.stack);
                alert('회원가입 중 오류가 발생했습니다: ' + (error.message || '알 수 없는 오류'));
            }
        }
        
        // 🚀 Google Sheets API 로그인 시스템
        async function handleGoogleLogin() {
            console.log('🔐 Google Sheets API 로그인 시작');
            
            try {
                // Google Sheets API 사용 가능 여부 확인
                if (!window.golfApp || !window.golfApp.isInitialized || !window.golfApp.googleSheetsAPI) {
                    alert('Google Sheets API가 초기화되지 않았습니다. 페이지를 새로고침하고 다시 시도해주세요.');
                    return;
                }
                
                console.log('✅ Google Sheets API 사용 가능');
                
                // Google OAuth 로그인
                if (!window.golfApp.googleSheetsAPI.isSignedIn) {
                    console.log('🔐 Google OAuth 로그인 필요...');
                    await window.golfApp.googleSheetsAPI.signIn();
                }
                
                if (window.golfApp.googleSheetsAPI.isSignedIn) {
                    console.log('✅ Google OAuth 로그인 성공');
                    alert('Google 로그인이 성공했습니다!');
                    document.getElementById('login-modal').style.display = 'none';
                    
                    // UI 업데이트 (Google 계정 정보 기반)
                    const userProfile = window.golfApp.googleSheetsAPI.currentUser;
                    updateUIAfterLogin(userProfile);
                } else {
                    throw new Error('Google OAuth 로그인 실패');
                }
                
            } catch (error) {
                console.error('❌ 로그인 오류:', error);
                alert('Google 로그인 중 오류가 발생했습니다: ' + (error.message || '알 수 없는 오류'));
            }
        }
        
        // UI 업데이트 함수
        function updateUIAfterLogin(user) {
            console.log('🔄 UI 업데이트 중...');
            
            // 로그인/회원가입 버튼 숨기기
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            if (loginBtn) loginBtn.style.display = 'none';
            if (registerBtn) registerBtn.style.display = 'none';
            
            // 로그아웃 버튼 표시
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.style.display = 'inline-block';
                logoutBtn.textContent = `${user.username} 로그아웃`;
            }
            
            // 로그인 안내 메시지 숨기기
            const loginPrompt = document.querySelector('.login-prompt');
            if (loginPrompt) loginPrompt.style.display = 'none';
            
            // 메인 콘텐츠 표시
            const mainContent = document.querySelector('.main-content');
            if (mainContent) mainContent.style.display = 'block';
            
            console.log('✅ UI 업데이트 완료');
        }
        
        // 🚀 Google Sheets API 로그아웃 함수
        async function handleLogout() {
            console.log('🚪 Google 로그아웃 처리 중...');
            
            try {
                // Google OAuth 로그아웃
                if (window.golfApp && window.golfApp.googleSheetsAPI && window.golfApp.googleSheetsAPI.isSignedIn) {
                    await window.golfApp.googleSheetsAPI.signOut();
                    console.log('✅ Google OAuth 로그아웃 성공');
                }
                
                // UI 복원
                const loginBtn = document.getElementById('login-btn');
                const registerBtn = document.getElementById('register-btn');
                const logoutBtn = document.getElementById('logout-btn');
                
                if (loginBtn) loginBtn.style.display = 'inline-block';
                if (registerBtn) registerBtn.style.display = 'inline-block';
                if (logoutBtn) logoutBtn.style.display = 'none';
                
                // 로그인 안내 메시지 표시
                const loginPrompt = document.querySelector('.login-prompt');
                if (loginPrompt) loginPrompt.style.display = 'block';
                
                // 메인 콘텐츠 숨기기
                const mainContent = document.querySelector('.main-content');
                if (mainContent) mainContent.style.display = 'none';
                
                console.log('✅ 로그아웃 완료');
                alert('Google 로그아웃되었습니다.');
                
            } catch (error) {
                console.error('❌ 로그아웃 오류:', error);
                alert('로그아웃 중 오류가 발생했습니다.');
            }
        }
        
        // 🚀 Google Sheets API 로그인 상태 확인
        function checkLoginStatus() {
            console.log('🔍 Google 로그인 상태 확인 중...');
            
            // Google Sheets API 초기화 대기 후 확인
            setTimeout(() => {
                if (window.golfApp && window.golfApp.googleSheetsAPI && window.golfApp.googleSheetsAPI.isSignedIn) {
                    console.log('✅ Google 로그인 상태 확인됨');
                    const userProfile = window.golfApp.googleSheetsAPI.currentUser;
                    if (userProfile) {
                        updateUIAfterLogin(userProfile);
                    }
                } else {
                    console.log('❌ Google 로그인되지 않음');
                }
            }, 3000); // 3초 후 확인 (API 초기화 대기)
        }
        
        // 페이지 로드 완료 후 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 페이지 로드 완료, 로그인 상태 확인');
            checkLoginStatus();
        });
        
        // 상세 진단 함수
        function diagnoseGoogleAPI() {
            console.log('🔍 === Google API 상태 진단 ===');
            console.log('  - window.gapi:', !!window.gapi, window.gapi);
            console.log('  - window.GoogleSheetsAPI:', typeof window.GoogleSheetsAPI, window.GoogleSheetsAPI);
            console.log('  - window.golfApp:', !!window.golfApp, window.golfApp);
            
            if (window.golfApp) {
                console.log('  - golfApp.isInitialized:', window.golfApp.isInitialized);
                console.log('  - golfApp.googleSheetsAPI:', !!window.golfApp.googleSheetsAPI);
                console.log('  - golfApp.initializationAttempts:', window.golfApp.initializationAttempts);
            }
            
            // Google API 기능 테스트
            if (window.gapi) {
                console.log('  - gapi.load:', typeof window.gapi.load);
                console.log('  - gapi.client:', typeof window.gapi.client);
                console.log('  - gapi.auth2:', typeof window.gapi.auth2);
            }
            
            // GoogleSheetsAPI 클래스 테스트
            if (window.GoogleSheetsAPI) {
                try {
                    const testInstance = new GoogleSheetsAPI();
                    console.log('  - GoogleSheetsAPI 인스턴스 생성:', '✅ 성공');
                    console.log('  - testInstance.clientId:', testInstance.clientId);
                    console.log('  - testInstance.spreadsheetId:', testInstance.spreadsheetId);
                } catch (error) {
                    console.log('  - GoogleSheetsAPI 인스턴스 생성:', '❌ 실패', error.message);
                }
            }
            
            console.log('🔍 === 진단 완료 ===');
        }
        
        // 수동 Google Sheets API 테스트 함수 (Console에서 호출 가능)
        window.testGoogleSheetsAPI = async function() {
            console.log('🧪 Google Sheets API 수동 테스트 시작...');
            
            try {
                const api = await forceInitializeGoogleAPI();
                console.log('✅ 강제 초기화 성공:', api);
                
                console.log('🔐 Google OAuth 테스트...');
                await api.signIn();
                console.log('✅ Google OAuth 성공');
                
                return api;
            } catch (error) {
                console.error('❌ Google Sheets API 테스트 실패:', error);
                return null;
            }
        };
        
        // 중간 확인 (500ms 후)
        setTimeout(() => {
            if (!window.golfApp && window.GolfScoreApp) {
                console.log('🔄 중간 확인: golfApp 생성 시도...');
                try {
                    window.golfApp = new GolfScoreApp();
                    window.golfApp.setupBasicUI();
                    console.log('✅ 중간 확인: golfApp 생성 성공');
                } catch (error) {
                    console.log('⚠️ 중간 확인: golfApp 생성 실패, 최종 확인에서 재시도');
                }
            }
        }, 500);
        
        // 최종 확인
        setTimeout(() => {
            console.log('🏁 모든 스크립트 로드 후 최종 상태:');
            console.log('  - window.golfApp:', window.golfApp);
            console.log('  - window.GoogleSheetsAPI:', typeof window.GoogleSheetsAPI);
            console.log('  - showLoginModal:', typeof showLoginModal);
            console.log('  - showRegisterModal:', typeof showRegisterModal);
            console.log('  - handleLoginSubmit:', typeof handleLoginSubmit);
            console.log('  - handleRegisterSubmit:', typeof handleRegisterSubmit);
            
            // 상세 진단 실행
            diagnoseGoogleAPI();
            
            console.log('💡 수동 테스트: Console에서 testGoogleSheetsAPI() 함수를 호출해보세요.');
            
            // 🚨 긴급 수정: golfApp이 없으면 강제 생성
            if (!window.golfApp && window.GolfScoreApp) {
                console.log('🚨 golfApp이 없음, 강제 생성 시도...');
                try {
                    window.golfApp = new GolfScoreApp();
                    console.log('✅ 강제 golfApp 생성 완료');
                    
                    // 기본 UI 설정
                    window.golfApp.setupBasicUI();
                    console.log('✅ 기본 UI 설정 완료');
                    
                    // Google API 초기화 시도
                    setTimeout(() => {
                        window.golfApp.waitForGoogleAPIAndInit();
                    }, 500);
                } catch (error) {
                    console.error('❌ 강제 golfApp 생성 실패:', error);
                }
            } else if (!window.GolfScoreApp) {
                console.error('❌ GolfScoreApp 클래스가 로드되지 않았습니다');
                console.log('📊 스크립트 로딩 상태:', window.scriptLoadStatus);
            }
            
            // 🔧 로그인 상태 강제 확인 및 UI 업데이트
            setTimeout(() => {
                console.log('🔍 페이지 로드 완료 후 로그인 상태 확인');
                if (window.googleSheetsAPI) {
                    console.log('🔍 GoogleSheetsAPI 상태:', {
                        isSignedIn: window.googleSheetsAPI.isSignedIn,
                        hasToken: !!window.googleSheetsAPI.accessToken,
                        currentUser: window.googleSheetsAPI.currentUser
                    });
                    
                    // 로그인 상태면 강제 UI 업데이트
                    if (window.googleSheetsAPI.isSignedIn && window.googleSheetsAPI.accessToken) {
                        console.log('🎯 로그인 상태 감지 - 강제 UI 업데이트 실행');
                        window.googleSheetsAPI.triggerUIUpdate();
                    }
                }
            }, 2000); // 2초 후 확인
        }, 1000);
    </script>
</body>
</html>