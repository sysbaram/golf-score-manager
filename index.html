<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- í‘œì¤€ ëª¨ë“œ ê°•ì œ ë° ë Œë”ë§ ìµœì í™” -->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    
    <!-- GitHub Pages í™˜ê²½ì—ì„œëŠ” CSP ë¹„í™œì„±í™” -->
    <script>
        // GitHub Pages í™˜ê²½ ê°ì§€ ë° CSP ì²˜ë¦¬
        const isGitHubPages = window.location.hostname.includes('github.io');
        if (isGitHubPages) {
            console.log('ğŸ”§ GitHub Pages í™˜ê²½ - CSP ì •ì±… ë¹„í™œì„±í™”');
            // GitHub Pagesì—ì„œëŠ” CSP ê´€ë ¨ ë©”íƒ€ íƒœê·¸ë¥¼ ë™ì ìœ¼ë¡œ ì œê±°
            const cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (cspMeta) {
                cspMeta.remove();
                console.log('âœ… CSP ë©”íƒ€ íƒœê·¸ ì œê±° ì™„ë£Œ');
            }
        } else {
            console.log('ğŸ”§ ë¡œì»¬ í™˜ê²½ - ê¸°ë³¸ ë³´ì•ˆ ì •ì±… ì ìš©');
        }
    </script>
    
    <!-- ì¶”ê°€ ë³´ì•ˆ í—¤ë” -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- CORS ë° ë³´ì•ˆ í—¤ë” (GitHub Pages ìµœì í™”) -->
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta http-equiv="Access-Control-Allow-Methods" content="GET, POST, PUT, DELETE, OPTIONS, HEAD, PATCH">
    <meta http-equiv="Access-Control-Allow-Headers" content="*">
    <meta http-equiv="Access-Control-Allow-Credentials" content="true">
    <meta http-equiv="Access-Control-Max-Age" content="86400">
    <meta name="description" content="Google Sheetsì™€ ì—°ë™í•˜ëŠ” í˜„ëŒ€ì ì¸ ê³¨í”„ ìŠ¤ì½”ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ. ìƒì„¸í•œ í™€ë³„ ê¸°ë¡ê³¼ í†µê³„ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.">
    <meta name="keywords" content="ê³¨í”„, ìŠ¤ì½”ì–´, ê´€ë¦¬, í†µê³„, Google Sheets, ë¼ìš´ë“œ">
    <meta name="author" content="Golf Score Manager">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sysbaram.github.io/golf-score-manager/">
    <meta property="og:title" content="ê³¨í”„ ìŠ¤ì½”ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ">
    <meta property="og:description" content="Google Sheetsì™€ ì—°ë™í•˜ëŠ” í˜„ëŒ€ì ì¸ ê³¨í”„ ìŠ¤ì½”ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ">
    <meta property="og:image" content="https://sysbaram.github.io/golf-score-manager/assets/preview.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://sysbaram.github.io/golf-score-manager/">
    <meta property="twitter:title" content="ê³¨í”„ ìŠ¤ì½”ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ">
    <meta property="twitter:description" content="Google Sheetsì™€ ì—°ë™í•˜ëŠ” í˜„ëŒ€ì ì¸ ê³¨í”„ ìŠ¤ì½”ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ">
    <meta property="twitter:image" content="https://sysbaram.github.io/golf-score-manager/assets/preview.png">
    
    <title>ê³¨í”„ ìŠ¤ì½”ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ | í˜„ëŒ€ì ì¸ ìŠ¤ì½”ì–´ ì¶”ì </title>
    
    <!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ (GitHub Pages ìµœì í™”) -->
    <link rel="stylesheet" href="./static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Google Fonts ìµœì í™” -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- PWA ê´€ë ¨ (GitHub Pages ìµœì í™”) -->
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./assets/apple-touch-icon.png">
    
    <!-- ì„±ëŠ¥ ìµœì í™” -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//apis.google.com">
    
    <!-- Google API ì •ì  ë¡œë”© (GitHub Pages ìµœì í™”) -->
    <script src="https://apis.google.com/js/api.js" async defer 
            onerror="console.error('âŒ Google API ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹¤íŒ¨')"
            onload="console.log('âœ… Google API ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ')"></script>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="header-content">
                <h1>
                    <i class="fas fa-golf-ball-tee"></i> 
                    ê³¨í”„ ìŠ¤ì½”ì–´ ê´€ë¦¬
                </h1>
                <p>Google Sheetsì™€ ì—°ë™í•˜ëŠ” í˜„ëŒ€ì ì¸ ìŠ¤ë§ˆíŠ¸ ìŠ¤ì½”ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                <div class="header-features">
                    <span class="feature-badge">
                        <i class="fas fa-chart-line"></i> ìƒì„¸ í†µê³„
                    </span>
                    <span class="feature-badge">
                        <i class="fas fa-mobile-alt"></i> ëª¨ë°”ì¼ ìµœì í™”
                    </span>
                    <span class="feature-badge">
                        <i class="fas fa-cloud"></i> í´ë¼ìš°ë“œ ë™ê¸°í™”
                    </span>
                </div>
            </div>
            <div class="user-section">
                <div id="user-info" class="user-info" style="display: none;">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                    <span id="welcome-message">ì•ˆë…•í•˜ì„¸ìš”, <strong id="username-display"></strong>ë‹˜!</span>
                        <small class="user-status">ì˜¨ë¼ì¸</small>
                    </div>
                    <button id="logout-btn" class="btn btn-outline">
                        <i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
                <div id="login-section" class="login-section">
                    <button id="login-btn" class="btn btn-outline">
                        <i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸
                    </button>
                    <button id="register-btn" class="btn btn-outline">
                        <i class="fas fa-user-plus"></i> íšŒì›ê°€ì…
                    </button>
                </div>
            </div>
        </header>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="score-input">
                <i class="fas fa-plus-circle"></i> ìŠ¤ì½”ì–´ ì…ë ¥
            </button>
            <button class="nav-tab" data-tab="rounds-history">
                <i class="fas fa-history"></i> ë¼ìš´ë“œ ê¸°ë¡
            </button>
            <button class="nav-tab" data-tab="statistics">
                <i class="fas fa-chart-bar"></i> í†µê³„
            </button>
        </nav>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- ìŠ¤ì½”ì–´ ì…ë ¥ íƒ­ -->
            <div id="score-input" class="tab-content active">
                <div class="card">
                    <h2><i class="fas fa-edit"></i> ìƒˆ ë¼ìš´ë“œ ê¸°ë¡</h2>
                    <form id="score-form">
                        <div class="form-group">
                            <label for="course-name">ì½”ìŠ¤ ì´ë¦„</label>
                            <input type="text" id="course-name" name="course_name" autocomplete="off" required>
                        </div>
                        
                        <div class="scores-grid">
                            <h3>í™€ë³„ ìƒì„¸ ìŠ¤ì½”ì–´ ì…ë ¥</h3>
                            <div class="detailed-scores-container">
                                <div class="holes-row">
                                    <div class="hole-group">
                                        <h4>ì•„ì›ƒì½”ìŠ¤ (1-9í™€)</h4>
                                        <div class="holes" id="holes-out">
                                            <!-- 1-9í™€ ìƒì„¸ ì…ë ¥ í•„ë“œ -->
                                        </div>
                                    </div>
                                    <div class="hole-group">
                                        <h4>ì¸ì½”ìŠ¤ (10-18í™€)</h4>
                                        <div class="holes" id="holes-in">
                                            <!-- 10-18í™€ ìƒì„¸ ì…ë ¥ í•„ë“œ -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="clear-scores" class="btn btn-secondary">
                                <i class="fas fa-eraser"></i> ì´ˆê¸°í™”
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> ì €ì¥
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ë¼ìš´ë“œ ê¸°ë¡ íƒ­ -->
            <div id="rounds-history" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-list"></i> ë¼ìš´ë“œ ê¸°ë¡</h2>
                    <div class="table-container">
                        <table id="rounds-table">
                            <thead>
                                <tr>
                                    <th>ë‚ ì§œ</th>
                                    <th>í”Œë ˆì´ì–´</th>
                                    <th>ì½”ìŠ¤</th>
                                    <th>ì´ ìŠ¤ì½”ì–´</th>
                                    <th>í•¸ë””ìº¡</th>
                                    <th>ìƒì„¸ë³´ê¸°</th>
                                </tr>
                            </thead>
                            <tbody id="rounds-tbody">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </tbody>
                        </table>
                    </div>
                    <button id="refresh-rounds" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            </div>

            <!-- í†µê³„ íƒ­ -->
            <div id="statistics" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-chart-line"></i> ë‚´ í†µê³„</h2>
                    <div class="stats-form">
                        <button id="get-stats" class="btn btn-primary">
                            <i class="fas fa-chart-bar"></i> í†µê³„ ì¡°íšŒ
                        </button>
                    </div>
                    <div id="stats-results" class="stats-results">
                        <!-- í†µê³„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
                    </div>
                </div>
            </div>
        </main>

        <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner">
                <i class="fas fa-golf-ball-tee fa-spin"></i>
                <p>ì²˜ë¦¬ ì¤‘...</p>
            </div>
        </div>

        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div id="notification" class="notification">
            <span id="notification-message"></span>
            <button id="notification-close">&times;</button>
        </div>

        <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-username">ì‚¬ìš©ìëª… ë˜ëŠ” ì´ë©”ì¼</label>
                        <input type="text" id="login-username" name="username" placeholder="ì‚¬ìš©ìëª… ë˜ëŠ” ì´ë©”ì¼ ì£¼ì†Œ" autocomplete="username" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="login-password" name="password" autocomplete="current-password" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary modal-close">ì·¨ì†Œ</button>
                        <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
                    </div>
                    <div class="divider">ë˜ëŠ”</div>
                    <button type="button" id="google-login-btn" class="btn btn-google">
                        <i class="fab fa-google"></i> Googleë¡œ ë¡œê·¸ì¸
                    </button>
                </form>
            </div>
        </div>

        <!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
        <div id="register-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-user-plus"></i> íšŒì›ê°€ì…</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-username">ì‚¬ìš©ìëª…</label>
                        <input type="text" id="register-username" name="username" autocomplete="username" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">ì´ë©”ì¼</label>
                        <input type="email" id="register-email" name="email" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="register-password" name="password" autocomplete="new-password" required minlength="6">
                        <small>ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.</small>
                    </div>
                    <div class="form-group">
                        <label for="register-password-confirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                        <input type="password" id="register-password-confirm" name="password_confirm" autocomplete="new-password" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary modal-close">ì·¨ì†Œ</button>
                        <button type="submit" class="btn btn-primary">íšŒì›ê°€ì…</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ ë° ë¦¬ì†ŒìŠ¤ ë¡œë”© ê²€ì¦ -->
    <script>
        // í˜ì´ì§€ ë¡œë”© ìƒíƒœ ë° ë¦¬ì†ŒìŠ¤ ê²€ì¦
        function verifyPageResources() {
            console.log('ğŸ” í˜ì´ì§€ ë¦¬ì†ŒìŠ¤ ë¡œë”© ìƒíƒœ í™•ì¸...');
            
            // DOCTYPE ë° ë Œë”ë§ ëª¨ë“œ í™•ì¸
            console.log('ğŸ“‹ ë¬¸ì„œ ì •ë³´:');
            console.log('  - DOCTYPE:', document.doctype ? 'HTML5' : 'ì—†ìŒ');
            console.log('  - í˜¸í™˜ ëª¨ë“œ:', document.compatMode); // CSS1Compat = Standards Mode, BackCompat = Quirks Mode
            console.log('  - ë¬¸ì„œ ì¤€ë¹„ ìƒíƒœ:', document.readyState);
            
            // ìŠ¤íƒ€ì¼ì‹œíŠ¸ ë¡œë”© ìƒíƒœ í™•ì¸
            console.log('ğŸ¨ ìŠ¤íƒ€ì¼ì‹œíŠ¸ ë¡œë”© ìƒíƒœ:');
            const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
            stylesheets.forEach((link, index) => {
                const href = link.href;
                const filename = href.split('/').pop();
                console.log(`ğŸ“„ ${index + 1}. ${filename}: ${href}`);
                
                // ë¡œë”© ìƒíƒœ í™•ì¸
                if (link.sheet) {
                    try {
                        const rules = link.sheet.cssRules || link.sheet.rules;
                        console.log(`   âœ… ë¡œë”© ì„±ê³µ (${rules.length} CSS ê·œì¹™)`);
                    } catch (e) {
                        console.log(`   âš ï¸ CORS ì œí•œìœ¼ë¡œ ê·œì¹™ ìˆ˜ í™•ì¸ ë¶ˆê°€`);
                    }
                } else {
                    console.log(`   âŒ ë¡œë”© ì‹¤íŒ¨ ë˜ëŠ” ëŒ€ê¸° ì¤‘`);
                }
            });
            
            // ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í™•ì¸
            console.log('ğŸ“œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìƒíƒœ:');
            const scripts = document.querySelectorAll('script[src]');
            scripts.forEach((script, index) => {
                const src = script.src;
                const filename = src.split('/').pop();
                console.log(`ğŸ“œ ${index + 1}. ${filename}: ${src}`);
            });
            
            // í°íŠ¸ ë¡œë”© í™•ì¸
            if (document.fonts) {
                document.fonts.ready.then(() => {
                    console.log('ğŸ”¤ í°íŠ¸ ë¡œë”© ìƒíƒœ:');
                    console.log(`   ì´ ${document.fonts.size}ê°œ í°íŠ¸ ë¡œë“œë¨`);
                    
                    const interFont = Array.from(document.fonts).find(font => 
                        font.family.includes('Inter')
                    );
                    if (interFont) {
                        console.log('   âœ… Inter í°íŠ¸ ë¡œë”© ì™„ë£Œ');
                    } else {
                        console.log('   âš ï¸ Inter í°íŠ¸ í™•ì¸ í•„ìš”');
                    }
                });
            }
            
            // ì˜¤ë¥˜ ê°ì§€ ë° ì²˜ë¦¬
            window.addEventListener('securitypolicyviolation', (e) => {
                console.error('ğŸš« CSP ìœ„ë°˜ ê°ì§€:', {
                    blockedURI: e.blockedURI,
                    violatedDirective: e.violatedDirective,
                    originalPolicy: e.originalPolicy
                });
            });
            
            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ê°ì§€
            window.addEventListener('error', (e) => {
                if (e.target && e.target.tagName) {
                    console.error(`âŒ ë¦¬ì†ŒìŠ¤ ë¡œë”© ì‹¤íŒ¨: ${e.target.tagName} - ${e.target.src || e.target.href}`);
                }
            });
            
            // CORS ì˜¤ë¥˜ ê°ì§€
            window.addEventListener('unhandledrejection', (e) => {
                if (e.reason && e.reason.message && e.reason.message.includes('CORS')) {
                    console.error('ğŸš« CORS ì˜¤ë¥˜ ê°ì§€:', e.reason.message);
                }
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ê²€ì¦
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', verifyPageResources);
        } else {
            verifyPageResources();
        }
    </script>

    <!-- Google API ì •ì  ë¡œë”© ì´ˆê¸°í™” -->
    <script>
        // GitHub Pages í™˜ê²½ ê°ì§€
        const isGitHubPages = window.location.hostname === 'sysbaram.github.io' || 
                              window.location.hostname.includes('github.io');
        
        console.log('ğŸŒ í™˜ê²½ ê°ì§€:', isGitHubPages ? 'GitHub Pages' : 'ë¡œì»¬');
        
        // Google API ì´ˆê¸°í™” ëŒ€ê¸°
        function waitForGoogleAPI() {
            console.log('â³ Google API ë¡œë”© ëŒ€ê¸° ì¤‘...');
            
            let attempts = 0;
            const maxAttempts = 50; // 5ì´ˆ ëŒ€ê¸°
            
            const checkGapi = () => {
                attempts++;
                
                if (window.gapi) {
                    console.log('âœ… Google API ë¡œë“œ ì™„ë£Œ');
                    // ì•±ì´ ì¤€ë¹„ë˜ë©´ ì´ˆê¸°í™”
                    if (window.golfApp) {
                        console.log('ğŸ”„ ì•± ì´ˆê¸°í™” ì‹œì‘...');
                        window.golfApp.init();
                    } else {
                        console.log('â³ ì•± ë¡œë”© ëŒ€ê¸° ì¤‘...');
                        setTimeout(() => {
                            if (window.golfApp) {
                                window.golfApp.init();
                            }
                        }, 1000);
                    }
                } else if (attempts < maxAttempts) {
                    if (attempts % 10 === 0) {
                        console.log(`â³ Google API ëŒ€ê¸° ì¤‘... (${attempts}/${maxAttempts})`);
                    }
                    setTimeout(checkGapi, 100);
                } else {
                    console.error('âŒ Google API ë¡œë”© ì‹œê°„ ì´ˆê³¼');
                    if (window.golfApp) {
                        console.log('ğŸ”„ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜...');
                        window.golfApp.enableFallbackMode();
                    }
                }
            };
            
            checkGapi();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ Google API ëŒ€ê¸° ì‹œì‘
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', waitForGoogleAPI);
        } else {
            waitForGoogleAPI();
        }
    </script>
    
    <!-- ì•± ìŠ¤í¬ë¦½íŠ¸ë“¤ (GitHub Pages ìµœì í™”) -->
    <script src="./static/js/google-sheets-api.js"></script>
    <script src="./static/js/app-github-pages.js"></script>
</body>
</html>