<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    
    <!-- GitHub Pages 보안 정책 완전 우회 -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; img-src * data: blob:; connect-src *; frame-src *; object-src *; media-src *; font-src *; child-src *; form-action *; frame-ancestors *; base-uri *;">
    <meta name="description" content="Google Sheets와 연동하는 현대적인 골프 스코어 관리 시스템. 상세한 홀별 기록과 통계 분석을 제공합니다.">
    <meta name="keywords" content="골프, 스코어, 관리, 통계, Google Sheets, 라운드">
    <meta name="author" content="Golf Score Manager">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sysbaram.github.io/golf-score-manager/">
    <meta property="og:title" content="골프 스코어 관리 시스템">
    <meta property="og:description" content="Google Sheets와 연동하는 현대적인 골프 스코어 관리 시스템">
    <meta property="og:image" content="https://sysbaram.github.io/golf-score-manager/assets/preview.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://sysbaram.github.io/golf-score-manager/">
    <meta property="twitter:title" content="골프 스코어 관리 시스템">
    <meta property="twitter:description" content="Google Sheets와 연동하는 현대적인 골프 스코어 관리 시스템">
    <meta property="twitter:image" content="https://sysbaram.github.io/golf-score-manager/assets/preview.png">
    
    <title>골프 스코어 관리 시스템 | 현대적인 스코어 추적</title>
    <link rel="stylesheet" href="static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- PWA 관련 -->
<<<<<<< HEAD
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
=======
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
>>>>>>> ec94e10975e853f38ecbfda29cffbdbc4b23f1dd
    
    <!-- 성능 최적화 -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <h1>
                    <i class="fas fa-golf-ball-tee"></i> 
                    골프 스코어 관리
                </h1>
                <p>Google Sheets와 연동하는 현대적인 스마트 스코어 관리 시스템</p>
                <div class="header-features">
                    <span class="feature-badge">
                        <i class="fas fa-chart-line"></i> 상세 통계
                    </span>
                    <span class="feature-badge">
                        <i class="fas fa-mobile-alt"></i> 모바일 최적화
                    </span>
                    <span class="feature-badge">
                        <i class="fas fa-cloud"></i> 클라우드 동기화
                    </span>
                </div>
            </div>
            <div class="user-section">
                <div id="user-info" class="user-info" style="display: none;">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                    <span id="welcome-message">안녕하세요, <strong id="username-display"></strong>님!</span>
                        <small class="user-status">온라인</small>
                    </div>
                    <button id="logout-btn" class="btn btn-outline">
                        <i class="fas fa-sign-out-alt"></i> 로그아웃
                    </button>
                </div>
                <div id="login-section" class="login-section">
                    <button id="login-btn" class="btn btn-outline">
                        <i class="fas fa-sign-in-alt"></i> 로그인
                    </button>
                    <button id="register-btn" class="btn btn-outline">
                        <i class="fas fa-user-plus"></i> 회원가입
                    </button>
                </div>
            </div>
        </header>

        <!-- 네비게이션 -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="score-input">
                <i class="fas fa-plus-circle"></i> 스코어 입력
            </button>
            <button class="nav-tab" data-tab="rounds-history">
                <i class="fas fa-history"></i> 라운드 기록
            </button>
            <button class="nav-tab" data-tab="statistics">
                <i class="fas fa-chart-bar"></i> 통계
            </button>
        </nav>

        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 스코어 입력 탭 -->
            <div id="score-input" class="tab-content active">
                <div class="card">
                    <h2><i class="fas fa-edit"></i> 새 라운드 기록</h2>
                    <form id="score-form">
                        <div class="form-group">
                            <label for="course-name">코스 이름</label>
                            <input type="text" id="course-name" name="course_name" required>
                        </div>
                        
                        <div class="scores-grid">
                            <h3>홀별 상세 스코어 입력</h3>
                            <div class="detailed-scores-container">
                                <div class="holes-row">
                                    <div class="hole-group">
                                        <h4>아웃코스 (1-9홀)</h4>
                                        <div class="holes" id="holes-out">
                                            <!-- 1-9홀 상세 입력 필드 -->
                                        </div>
                                    </div>
                                    <div class="hole-group">
                                        <h4>인코스 (10-18홀)</h4>
                                        <div class="holes" id="holes-in">
                                            <!-- 10-18홀 상세 입력 필드 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="clear-scores" class="btn btn-secondary">
                                <i class="fas fa-eraser"></i> 초기화
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> 저장
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 라운드 기록 탭 -->
            <div id="rounds-history" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-list"></i> 라운드 기록</h2>
                    <div class="table-container">
                        <table id="rounds-table">
                            <thead>
                                <tr>
                                    <th>날짜</th>
                                    <th>플레이어</th>
                                    <th>코스</th>
                                    <th>총 스코어</th>
                                    <th>핸디캡</th>
                                    <th>상세보기</th>
                                </tr>
                            </thead>
                            <tbody id="rounds-tbody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>
                    <button id="refresh-rounds" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> 새로고침
                    </button>
                </div>
            </div>

            <!-- 통계 탭 -->
            <div id="statistics" class="tab-content">
                <div class="card">
                    <h2><i class="fas fa-chart-line"></i> 내 통계</h2>
                    <div class="stats-form">
                        <button id="get-stats" class="btn btn-primary">
                            <i class="fas fa-chart-bar"></i> 통계 조회
                        </button>
                    </div>
                    <div id="stats-results" class="stats-results">
                        <!-- 통계 결과가 여기에 표시됨 -->
                    </div>
                </div>
            </div>
        </main>

        <!-- 로딩 오버레이 -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner">
                <i class="fas fa-golf-ball-tee fa-spin"></i>
                <p>처리 중...</p>
            </div>
        </div>

        <!-- 알림 메시지 -->
        <div id="notification" class="notification">
            <span id="notification-message"></span>
            <button id="notification-close">&times;</button>
        </div>

        <!-- 로그인 모달 -->
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-sign-in-alt"></i> 로그인</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-username">사용자명 또는 이메일</label>
                        <input type="text" id="login-username" name="username" placeholder="사용자명 또는 이메일 주소" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">비밀번호</label>
                        <input type="password" id="login-password" name="password" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary modal-close">취소</button>
                        <button type="submit" class="btn btn-primary">로그인</button>
                    </div>
                    <div class="divider">또는</div>
                    <button type="button" id="google-login-btn" class="btn btn-google">
                        <i class="fab fa-google"></i> Google로 로그인
                    </button>
                </form>
            </div>
        </div>

        <!-- 회원가입 모달 -->
        <div id="register-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-user-plus"></i> 회원가입</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-username">사용자명</label>
                        <input type="text" id="register-username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">이메일</label>
                        <input type="email" id="register-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">비밀번호</label>
                        <input type="password" id="register-password" name="password" required minlength="6">
                        <small>비밀번호는 6자 이상이어야 합니다.</small>
                    </div>
                    <div class="form-group">
                        <label for="register-password-confirm">비밀번호 확인</label>
                        <input type="password" id="register-password-confirm" name="password_confirm" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary modal-close">취소</button>
                        <button type="submit" class="btn btn-primary">회원가입</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Google Sheets API - GitHub Pages 완전 최적화 -->
    <script>
        // GitHub Pages 환경 감지
        const isGitHubPages = window.location.hostname === 'sysbaram.github.io' || 
                              window.location.hostname.includes('github.io');
        
        console.log('🌐 환경 감지:', isGitHubPages ? 'GitHub Pages' : '로컬');
        
        // Google API 로딩 상태 관리
        let googleApiLoadAttempts = 0;
        const maxLoadAttempts = 3; // 5번 → 3번으로 단축
        let fallbackModeEnabled = false;
        
        // Google API 로딩 완료 후 초기화
        window.gapiOnLoad = function() {
            console.log('✅ Google API 로딩 완료');
            window.googleApiLoaded = true;
            
            // GitHub Pages에서는 적절한 지연 시간 적용
            const delay = isGitHubPages ? 2000 : 500; // 5초 → 2초로 단축
            setTimeout(() => {
                if (window.golfApp && !fallbackModeEnabled) {
                    console.log('🔄 앱 재초기화 시도...');
                    window.golfApp.init();
                }
            }, delay);
        };
        
        // Google API 로딩 실패 시 처리
        window.gapiOnError = function(error) {
            console.error('❌ Google API 로딩 실패:', error);
            googleApiLoadAttempts++;
            
            if (googleApiLoadAttempts < maxLoadAttempts) {
                console.log(`🔄 Google API 재로딩 시도 ${googleApiLoadAttempts}/${maxLoadAttempts}`);
                setTimeout(() => {
                    loadGoogleAPI();
                }, 2000 * googleApiLoadAttempts); // 3초 → 2초로 단축
            } else {
                console.log('❌ Google API 로딩 최종 실패 - 대체 방안 활성화');
                if (window.golfApp && !fallbackModeEnabled) {
                    fallbackModeEnabled = true;
                    console.log('🔄 자동 오프라인 모드 전환 시작');
                    window.golfApp.enableFallbackMode();
                }
            }
        };
        
        // Google API 간단한 로딩 함수
        function loadGoogleAPI() {
            console.log('📡 Google API 로딩 시작...');
            
            // 기존 스크립트 제거
            const existingScripts = document.querySelectorAll('script[src*="apis.google.com"], script[src*="gstatic.com"]');
            existingScripts.forEach(script => script.remove());
            
            // 간단한 Google API 로딩
            const script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js';
            script.async = true;
            script.defer = true;
            
            script.onload = () => {
                console.log('✅ Google API 스크립트 로드 완료');
                // Google API 로드 완료 후 초기화
                setTimeout(() => {
                    if (window.gapi && window.gapi.load) {
                        console.log('✅ Google API 사용 가능');
                        window.gapiOnLoad();
                    } else {
                        console.error('❌ Google API 사용 불가');
                        window.gapiOnError(new Error('Google API not available'));
                    }
                }, 1000);
            };
            
            script.onerror = () => {
                console.error('❌ Google API 스크립트 로드 실패');
                window.gapiOnError(new Error('Failed to load Google API script'));
            };
            
            document.head.appendChild(script);
        }
        
        // 즉시 Google API 로딩 시작 (환경 구분 없이)
        console.log('🔧 Google API 로딩 즉시 시작');
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(loadGoogleAPI, 100); // 2초 → 0.1초로 단축
            });
        } else {
            setTimeout(loadGoogleAPI, 100); // 즉시 시작
        }
    </script>
    
    <!-- 앱 스크립트들 -->
    <script src="static/js/google-sheets-api.js"></script>
    <script src="static/js/app-github-pages.js"></script>
</body>
</html>